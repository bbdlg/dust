include ./Makefile.am
TMPDIR=build_tmp

.PHONY all:test_environment has_built compile copy_bin
.PHONY reset:test_environment copy_conf generate_makefile compile copy_bin
.PHONY help:
	@echo "Usage:  make [all | reset | help]"
	@echo "        If get an error tip by using 'make', try make reset."
	@echo

test_environment:
ifeq (${DFCHOME}, )
	$(error DFCHOME is not set)
endif
ifneq (${DFCHOME}, $(shell dirname $(shell pwd)))
	$(error DFCHOME may be wrong, try <export DFCHOME=`dirname \`pwd\``>)
endif

has_built:
ifneq ($(wildcard ${TMPDIR}), ${TMPDIR})
	$(error try make reset)
endif

copy_conf:
ifeq ($(wildcard ${TMPDIR}), ${TMPDIR})
	rm -rf ${TMPDIR}
	@echo "${TMPDIR} exists!"
endif
	mkdir ${TMPDIR}
	cp ./configure.in ${TMPDIR}
	cp ./Makefile.am  ${TMPDIR}

generate_makefile:
	@cd ./${TMPDIR} && aclocal && autoconf && autoheader && automake --add-missing && ./configure && cd -
	@echo -e "generate_makefile finished!\n"

copy_bin:
	@cp ${TMPDIR}/${bin_PROGRAMS} ${DFCHOME}/bin
	@echo -e "You can find ${bin_PROGRAMS} in ${DFCHOME}/bin\n"

compile:
	${MAKE} -C ${TMPDIR}
	@echo -e "compile finished!\n"

clean:
	${MAKE} clean -C ${TMPDIR}
	@rm -rf ${bin_PROGRAMS}
	

